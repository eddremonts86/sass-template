# Trae AI - Documento de Instrucciones Técnicas

## 1. Identidad y Propósito de Trae AI

### Misión
Trae AI es un asistente de desarrollo inteligente especializado en la creación de aplicaciones web modernas utilizando Next.js, React y tecnologías de vanguardia. Su propósito es garantizar la implementación de código de alta calidad, siguiendo las mejores prácticas de la industria y manteniendo estándares consistentes en todos los proyectos.

### Principios Fundamentales
- **Calidad sobre Velocidad**: Priorizar la implementación correcta y mantenible
- **Consistencia Arquitectónica**: Seguir patrones establecidos y convenciones uniformes
- **Experiencia de Usuario Excepcional**: Implementar Clean UI/UX Design en todas las interfaces
- **Código Autodocumentado**: Escribir código claro, legible y bien documentado
- **Escalabilidad desde el Inicio**: Diseñar arquitecturas que soporten crecimiento futuro

## 2. Requisitos Generales de Implementación

### 2.1 Stack Tecnológico Obligatorio

#### Framework Principal
- **Next.js** (versión 15.5.4+) - Framework React con SSR/SSG y App Router
- **React** (versión 19.1.0+) - Biblioteca de interfaz de usuario
- **TypeScript** (versión 5+) - Tipado estático obligatorio

#### Sistema de Componentes y Estilos
- **Shadcn/ui** - Sistema de componentes base (obligatorio para nuevos componentes)
- **Tailwind CSS** (versión 4+) - Framework de estilos utilitarios
- **Radix UI** - Componentes primitivos accesibles
- **Lucide React** - Biblioteca de iconos (uso exclusivo)
- **Class Variance Authority (CVA)** - Gestión de variantes de componentes

#### Gestión de Estado y Datos
- **Zustand** (versión 5.0.8+) - Estado global ligero y eficiente
- **TanStack Query** (versión 5.90.2+) - Gestión de estado del servidor
- **TanStack Table** (versión 8.21.3+) - Componentes de tabla avanzados
- **TanStack Form** (versión 1.23.5+) - Gestión de formularios reactivos
- **ag-grid-react** (versión 34.2.0+) - Tablas para grandes volúmenes de datos

#### Autenticación y Internacionalización
- **Clerk.js** (versión 6.33.2+) - Sistema de autenticación completo
- **next-intl** (versión 4.3.9+) - Internacionalización con soporte para:
  - Danés (da)
  - Inglés (en) 
  - Español (es)

#### Herramientas de Desarrollo
- **pnpm** - Gestor de paquetes (OBLIGATORIO - no usar npm o yarn)
- **ESLint** (versión 9+) - Análisis estático de código
- **Prettier** (versión 3.6.2+) - Formateo automático de código
- **Husky** (versión 9.1.7+) - Git hooks para calidad de código
- **lint-staged** - Ejecución de linters en archivos staged

#### Documentación
- **VitePress** (versión 1.6.4+) - Generación de documentación estática
- **JSDoc** (versión 4.0.4+) - Documentación automática de código

### 2.2 Arquitectura de Proyecto

```
template-trae/
├── .github/workflows/          # CI/CD pipelines
├── .husky/                     # Git hooks
├── .vscode/                    # Configuración del editor
├── docs/                       # Documentación VitePress
│   ├── .vitepress/
│   ├── api/                    # Documentación de API
│   ├── components/             # Documentación de componentes
│   ├── guide/                  # Guías de uso
│   └── patterns/               # Patrones de diseño
├── public/                     # Assets estáticos
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── [locale]/           # Rutas internacionalizadas
│   │   ├── globals.css         # Estilos globales
│   │   └── layout.tsx          # Layout principal
│   ├── components/             # Componentes reutilizables
│   │   ├── ui/                 # Componentes Shadcn/ui
│   │   ├── layouts/            # Layouts de página
│   │   ├── forms/              # Componentes de formularios
│   │   └── tables/             # Componentes de tablas
│   ├── hooks/                  # Custom React hooks
│   ├── lib/                    # Utilidades y configuraciones
│   │   ├── auth/               # Configuración de autenticación
│   │   ├── i18n/               # Configuración de internacionalización
│   │   ├── constants/          # Constantes de la aplicación
│   │   └── utils/              # Funciones utilitarias
│   ├── stores/                 # Zustand stores
│   ├── types/                  # Definiciones TypeScript
│   └── patterns/               # Implementaciones de patrones
├── tests/                      # Tests unitarios e integración
├── .eslintrc.js               # Configuración ESLint
├── .prettierrc                # Configuración Prettier
├── components.json            # Configuración Shadcn/ui
├── next.config.ts             # Configuración Next.js
├── tailwind.config.js         # Configuración Tailwind
├── tsconfig.json              # Configuración TypeScript
└── package.json               # Dependencias y scripts
```

## 3. Directrices Específicas de Desarrollo

### 3.1 Convenciones de Nomenclatura

#### Archivos y Carpetas
- **Componentes**: PascalCase (`UserProfile.tsx`, `DataTable.tsx`)
- **Hooks**: camelCase con prefijo "use" (`useAuth.ts`, `useLocalStorage.ts`)
- **Utilidades**: camelCase (`formatDate.ts`, `validateEmail.ts`)
- **Constantes**: UPPER_SNAKE_CASE (`API_ENDPOINTS.ts`, `THEME_COLORS.ts`)
- **Tipos**: PascalCase con sufijo "Type" o "Interface" (`UserType.ts`, `ApiResponse.interface.ts`)
- **Carpetas**: kebab-case (siguiendo convención del proyecto base)

#### Variables y Funciones
- **Variables**: camelCase (`userName`, `isLoading`, `apiResponse`)
- **Funciones**: camelCase (`handleSubmit`, `fetchUserData`, `validateForm`)
- **Constantes**: UPPER_SNAKE_CASE (`MAX_RETRY_ATTEMPTS`, `DEFAULT_TIMEOUT`)
- **Componentes**: PascalCase (`UserCard`, `NavigationMenu`, `DataGrid`)

#### Arquitectura de Carpetas y Componentes (Basado en project_rules.md)

##### Estructura Basada en Características
- **Organización por característica**, no por tipo
- **Organización de características**: Siempre organizar las características en las siguientes categorías cuando sea posible:
  - **Components**: Componentes reutilizables siguiendo principios de diseño atómico (atoms, molecules, organisms, etc.)
  - **Hooks**: Lógica reutilizable con hooks (camelCase, prefijo `use`, lógica de negocio separada de UI)
  - **Const**: Constantes y configuraciones
  - **Providers**: Contextos y proveedores de estado
  - **Utils**: Funciones utilitarias (camelCase)

##### Agrupación Funcional
- **Crear carpetas específicas** para agrupar funcionalidades relacionadas
- **Cada carpeta** debe contener todos los elementos necesarios para una función específica

##### Estructura de Componentes
- **Carpetas de componentes**: PascalCase, incluir `.tsx` principal, `types.ts`, `index.ts`, estilos y tests
- **Tipos**: camelCase, colocados en `src/types/`
- **Carpetas**: kebab-case
- **Documentación**: Solo crear archivos de documentación (.md, README) cuando se solicite explícitamente. No crear archivos de ejemplo o documentación explicativa de forma proactiva
- **JSDoc**: Todas las características/componentes deben tener comentarios JSDoc para documentación adecuada

##### Patrones UI y Estado
- **Componentes genéricos, reutilizables y type-safe**
- **Tablas jerárquicas**: Usar tipos/utilidades/hooks genéricos, sin dependencias de características en componentes globales
- **Gestión de estado**: Centralizada vía hooks/stores personalizados (Zustand), estado UI reflejado en stores
- **Manejo de errores**: Usar `ErrorAlertsList` con botones accionables
- **Lógica de selección**: Usar utilidad genérica `cleanArray` para filtrado de arrays

##### Estilos y Temas
- **Tailwind CSS**: Usado para todos los estilos, con plugin Prettier para ordenamiento de clases
- **Estilos globales**: En `src/styles/`

##### Commits y Contribución
- **Commits convencionales**: Aplicados vía commitlint
- **Nomenclatura de ramas**: `feature/<name>`, `fix/<issue>`
- **Pull requests**: Deben incluir descripción, enlace a issues y pasar todas las verificaciones

### 3.2 Patrones de Desarrollo Obligatorios

#### React Performance & Optimization Rules (Basado en project_rules.md)

**REQUISITOS CRÍTICOS**: Seguir estas reglas para evitar renders innecesarios y bucles infinitos en React.

##### 1. DEPENDENCIAS DE HOOKS
- `useEffect` / `useMemo` / `useCallback`: nunca omitir el array de dependencias
- No mentir a React: si una variable se usa dentro del efecto, debe estar en el array
- Regla de oro: si ESLint (`react-hooks/exhaustive-deps`) se queja, arréglalo, no lo silencies
- Objetos/funciones inline en deps ⇒ extraer a `useMemo`/`useCallback` primero

##### 2. ESTADO LOCAL VS GLOBAL
- Elevar estado solo cuando sea realmente necesario; evitar que el padre re-renderice todos los hijos por datos que solo necesita un hijo
- División de contexto: separar Contextos pesados (auth, theme, cart) en múltiples archivos para que los cambios no disparen re-renders globales
- Zustand / Jotai / Recoil > Context masivo cuando el árbol es grande

##### 3. MEMOIZACIÓN DE COMPONENTES
- `React.memo` para componentes hijos que reciben props primitivas o estabilizadas
- Siempre acompañar `React.memo` con `useCallback`/`useMemo` para funciones/objetos pasados como props
- Comparación personalizada con `areEqual` solo si la comparación superficial no es suficiente

##### 4. FUNCIONES Y OBJETOS INLINE
- Definir fuera del render cualquier función pura que no dependa de props/state
- `useCallback` para funciones pasadas a hijos memoizados o usadas en deps de hooks
- `useMemo` para objetos/arrays calculados desde props/state
- Evitar funciones flecha en JSX (`onClick={() => …}`) a menos que estén previamente memoizadas

##### 5. KEYS EN LISTAS
- Key única y estable (ID de BD, no índice del array)
- No usar `Math.random()` o `Date.now()` como key
- Re-ordenar listas ⇒ key debe continuar identificando el mismo elemento

##### 6. ASYNC / AWAIT EN useEffect
- No marcar `useEffect` como async; crear función async interna y llamarla inmediatamente
- `AbortController` / flag mounted para evitar setState en componente desmontado
- Limpiar timers, listeners y suscripciones en el return de useEffect

##### 7. CICLOS DE ACTUALIZACIÓN
- No setear el mismo estado con el valor que ya tiene (React no lo bloqueará)
- Evitar efectos que setean estado disparando el mismo efecto ⇒ revisar deps
- `useRef` para valores que no necesitan disparar render pero deben persistir

##### 8. RENDERIZADO CONDICIONAL TEMPRANO
- Return temprano en lugar de anidar JSX dentro de condicionales pesados
- Lazy load (`React.lazy` + `Suspense`) para rutas pesadas y modales

##### 9. PROPS DRILLING
- Componer children (patrón "slots") en lugar de pasar props 5 niveles abajo
- Context o estado externo solo cuando múltiples niveles necesitan los mismos datos

##### 10. HERRAMIENTAS DE DESARROLLO
- React DevTools Profiler → grabar interacción y ver qué componentes re-renderizan y por qué
- ¿Por qué se re-renderizó? (React DevTools → Settings → Highlight updates)
- `eslint-plugin-react-hooks` SIEMPRE habilitado

##### 11. ANTI-PATRONES SEVEROS
- ❌ `setState` en el cuerpo del componente (fuera de useEffect/evento)
- ❌ `useEffect` sin deps que solo "calcula" derivado ⇒ usar `useMemo`
- ❌ Efecto dependiendo de sí mismo (ej. dep `[value]` y dentro `setValue(value + 1)`)
- ❌ Mutar estado directamente (`push`, `splice`, etc.) ⇒ siempre nuevo objeto/array

##### 12. CHECKLIST RÁPIDO ANTES DE PUSH
- [ ] No `useEffect` sin array de dependencias
- [ ] No función/objeto inline pasado a hijo memoizado
- [ ] No `key={index}` o `key={Math.random()}`
- [ ] No `setState` dentro de render puro
- [ ] Todos los valores derivados en `useMemo`, no en `useEffect` o render
- [ ] `AbortController` o flag mounted en efectos con fetch
- [ ] React DevTools no muestra flashes de re-render en árbol estable

#### Container/Presentational Pattern
```typescript
// Container Component
const UserListContainer = () => {
  const { users, loading } = useUsers();
  return <UserListPresentation users={users} loading={loading} />;
};

// Presentational Component
interface UserListPresentationProps {
  users: User[];
  loading: boolean;
}
const UserListPresentation = ({ users, loading }: UserListPresentationProps) => {
  // Solo lógica de presentación
};
```

#### Custom Hooks Pattern
```typescript
const useAuth = () => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  
  // Lógica de autenticación
  
  return { user, loading, login, logout };
};
```

#### Compound Component Pattern
```typescript
const Modal = ({ children }: { children: React.ReactNode }) => {
  return <div className="modal">{children}</div>;
};

Modal.Header = ({ children }: { children: React.ReactNode }) => {
  return <div className="modal-header">{children}</div>;
};

Modal.Body = ({ children }: { children: React.ReactNode }) => {
  return <div className="modal-body">{children}</div>;
};
```

### 3.3 Gestión de Estado

#### Zustand Store Pattern
```typescript
interface AuthStore {
  user: User | null;
  isAuthenticated: boolean;
  login: (credentials: LoginCredentials) => Promise<void>;
  logout: () => void;
}

const useAuthStore = create<AuthStore>((set, get) => ({
  user: null,
  isAuthenticated: false,
  login: async (credentials) => {
    // Lógica de login
    set({ user: userData, isAuthenticated: true });
  },
  logout: () => {
    set({ user: null, isAuthenticated: false });
  },
}));
```

### 3.4 Componentes UI

#### Shadcn/ui Integration
- **OBLIGATORIO**: Usar `shadcn add` para nuevos componentes UI
- **Personalización**: Modificar solo a través de CSS variables en `globals.css`
- **Variantes**: Utilizar CVA para variantes de componentes

```typescript
import { cn } from "@/lib/utils";
import { cva, type VariantProps } from "class-variance-authority";

const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);
```

### 3.5 Internacionalización

#### Estructura de Traducciones
```json
// messages/es.json
{
  "navigation": {
    "home": "Inicio",
    "about": "Acerca de",
    "contact": "Contacto"
  },
  "common": {
    "loading": "Cargando...",
    "error": "Error",
    "success": "Éxito"
  }
}
```

#### Uso en Componentes
```typescript
import { useTranslations } from 'next-intl';

const Navigation = () => {
  const t = useTranslations('navigation');
  
  return (
    <nav>
      <Link href="/">{t('home')}</Link>
      <Link href="/about">{t('about')}</Link>
    </nav>
  );
};
```

## 4. Sistema de Verificación de Calidad Obligatorio

**REQUISITO CRÍTICO**: Ninguna tarea puede considerarse completa sin pasar TODAS las verificaciones de calidad. Este es un sistema de verificación OBLIGATORIO que debe ejecutarse antes de marcar cualquier tarea como finalizada.

### 4.1 Verificaciones de Calidad Requeridas (Todas Deben Pasar)

#### 1. Verificación de Ortografía
- **Comando**: `pnpm run check:spell`
- **Criterio**: Debe retornar 0 errores y 0 advertencias
- **Acción**: Corregir todos los errores tipográficos y ortográficos antes de proceder

#### 2. Compilación de Build
- **Comando**: `pnpm run build`
- **Criterio**: Debe completarse con código de salida 0
- **Acción**: No se permiten errores o advertencias de compilación TypeScript

#### 3. Linting y Formateo de Código
- **Comandos**: 
  - `pnpm run lint`
  - `pnpm run check:format`
- **Criterio**: Debe retornar 0 errores ESLint Y 0 advertencias
- **Acción**: Debe pasar las verificaciones de formateo Prettier sin problemas

#### 4. Verificación de Tipos TypeScript
- **Incluido en**: Proceso de build
- **Criterio**: No se permiten errores o advertencias de tipos
- **Acción**: Mantener tipado estricto con tolerancia cero para advertencias

#### 5. Revisión de Calidad de Código
- Eliminar comentarios innecesarios
- Asegurar documentación JSDoc adecuada
- Verificar que no hay código muerto o imports no utilizados

### 4.2 Procedimientos de Detección Automatizada

```bash
# Secuencia completa de verificación de calidad (todas deben pasar)
pnpm run check:spell     # Verificación ortográfica
pnpm run lint           # Verificación ESLint
pnpm run check:format   # Verificación Prettier
pnpm run build          # Verificación TypeScript y build
```

### 4.3 Protocolo de Notificación y Corrección de Errores

1. **Detección**: Ejecutar todas las verificaciones de calidad en secuencia
2. **Notificación**: Cualquier verificación fallida debe reportarse con:
   - Detalles específicos del error
   - Ubicaciones de archivos
   - Correcciones sugeridas
3. **Corrección**: TODOS los errores deben corregirse antes de completar la tarea
4. **Re-verificación**: Re-ejecutar todas las verificaciones después de las correcciones
5. **Finalización**: Solo proceder cuando TODAS las verificaciones pasen con 0 errores/advertencias

### 4.4 Reglas de Aplicación

- **Tolerancia Cero**: No hay excepciones para fallas en verificaciones de calidad (errores O advertencias)
- **Cobertura Completa**: Todos los archivos modificados deben pasar las verificaciones de calidad con cero errores y cero advertencias
- **Documentación**: Todas las correcciones deben documentarse en mensajes de commit
- **Verificación**: La verificación final debe realizarse antes del cierre de la tarea
- **Política de Advertencias**: Las advertencias se tratan como fallas y deben resolverse antes de la finalización

### 4.5 Logging Centralizado

#### Sistema de Logger Obligatorio
- **Ubicación**: `src/lib/utils/logger.ts`
- **Prohibido**: Uso de métodos `console` directos
- **Imports requeridos**: `logInfo`, `logWarn`, `logError`, `logDebug`
- **Características**: 
  - Logging basado en módulos
  - Niveles configurables
  - Almacenamiento persistente

```typescript
// Ejemplo de uso correcto
import { logInfo, logError } from '@/lib/utils/logger';

// ❌ Incorrecto
console.log('Debug info');

// ✅ Correcto
logInfo('Debug info', { module: 'UserAuth' });
```

### 4.6 Herramientas de Desarrollo IDE

#### Extensiones VS Code Recomendadas
- **ESLint**: Análisis en tiempo real
- **Prettier**: Formateo automático
- **SonarLint**: Feedback de calidad de código en tiempo real
- **Error Lens**: Visualización de errores inline
- **Tailwind CSS IntelliSense**: Autocompletado de clases
- **CodeMetrics**: Métricas de complejidad
- **Import Cost**: Análisis de tamaño de imports
- **Pretty TypeScript Errors**: Errores TypeScript legibles

### 4.7 Análisis Estático de Código

#### ESLint - Reglas Obligatorias
```javascript
{
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "error", // Cambiado de "warn" a "error"
    "no-console": "error", // Prohibir console.log
    "no-duplicate-imports": "error"
  }
}
```

#### Prettier - Configuración Estándar
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false
}
```

### 4.8 Git Hooks y Automatización

#### Husky + lint-staged
```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "pre-push": "pnpm run type-check && pnpm run test && pnpm run check:spell",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  },
  "lint-staged": {
    "*.{ts,tsx,js,jsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{md,json}": [
      "prettier --write"
    ]
  }
}
```

### 4.9 Tests y Automatización

#### Playwright - Tests E2E
- **Comando**: `pnpm run test:app`
- **Configuración**: `playwright.config.ts`
- **Cobertura mínima**: 80% en flujos críticos

#### Tests Unitarios
- **Ubicación**: Junto a componentes con sufijo `.test.tsx`
- **Cobertura mínima**: 85% para funciones críticas
- **API Falsa**: `pnpm run fake:api` para desarrollo local

#### Scripts de Calidad
```json
{
  "scripts": {
    "check:isReady": "pnpm run check:spell && pnpm run lint && pnpm run check:format && pnpm run build && pnpm run test",
    "format:fix": "prettier --write .",
    "check:format": "prettier --check .",
    "check:spell": "cspell \"**/*.{ts,tsx,md,json}\"",
    "lint": "eslint . --fix"
  }
}
```

## 5. Referencias y Mejores Prácticas

### 5.1 Recursos de Componentes Compatibles

#### Bibliotecas Aprobadas
- **Shadcn/ui**: https://ui.shadcn.com/
- **Shadcn Blocks**: https://ui.shadcn.com/blocks
- **Aceternity UI**: https://ui.aceternity.com/
- **Radix UI**: https://www.radix-ui.com/

#### Context7 MCP - Soluciones Existentes
Antes de implementar nuevas funcionalidades, verificar:
1. **Requisitos de seguridad** cumplidos
2. **Mantenibilidad a largo plazo** garantizada
3. **Compatibilidad** con el stack tecnológico
4. **Documentación** adecuada disponible

### 5.2 Patrones de Rendering

#### Static Site Generation (SSG)
```typescript
// Para páginas estáticas
export async function generateStaticParams() {
  return [
    { locale: 'en' },
    { locale: 'es' },
    { locale: 'da' }
  ];
}
```

#### Server-Side Rendering (SSR)
```typescript
// Para páginas dinámicas con datos del servidor
export default async function Page({ params }: { params: { id: string } }) {
  const data = await fetchData(params.id);
  return <PageComponent data={data} />;
}
```

### 5.3 Optimización de Performance

#### Image Optimization
```typescript
import Image from 'next/image';

const OptimizedImage = () => (
  <Image
    src="/hero-image.jpg"
    alt="Hero image"
    width={800}
    height={600}
    priority
    placeholder="blur"
    blurDataURL="data:image/jpeg;base64,..."
  />
);
```

#### Bundle Analysis
```bash
# Análisis obligatorio antes de producción
pnpm build
pnpm run analyze
```

### 5.4 Configuración de Producción

#### Variables de Entorno
```bash
# .env.local
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
```

#### Next.js Configuration
```typescript
// next.config.ts
const nextConfig = {
  experimental: {
    turbopack: true,
  },
  images: {
    domains: ['example.com'],
    formats: ['image/webp', 'image/avif'],
  },
  i18n: {
    locales: ['en', 'es', 'da'],
    defaultLocale: 'en',
  },
};
```

## 6. Documentación Obligatoria

### 6.1 JSDoc - Estándar Requerido

```typescript
/**
 * Autentica un usuario con las credenciales proporcionadas
 * @param credentials - Objeto con email y password del usuario
 * @returns Promise que resuelve con los datos del usuario autenticado
 * @throws {AuthError} Cuando las credenciales son inválidas
 * @example
 * ```typescript
 * const user = await authenticateUser({
 *   email: 'user@example.com',
 *   password: 'securePassword123'
 * });
 * ```
 */
async function authenticateUser(credentials: LoginCredentials): Promise<User> {
  // Implementación
}
```

### 6.2 VitePress - Estructura de Documentación

```markdown
# Documentación del Proyecto

## Componentes
- [Button](./components/button.md)
- [Modal](./components/modal.md)
- [DataTable](./components/data-table.md)

## Hooks
- [useAuth](./hooks/use-auth.md)
- [useLocalStorage](./hooks/use-local-storage.md)

## Patrones
- [Container/Presentational](./patterns/container-presentational.md)
- [Custom Hooks](./patterns/custom-hooks.md)
```

## 7. Seguridad y Compliance

### 7.1 Headers de Seguridad Obligatorios

#### Configuración Next.js
```typescript
// next.config.ts
const securityHeaders = [
  {
    key: 'X-DNS-Prefetch-Control',
    value: 'on'
  },
  {
    key: 'Strict-Transport-Security',
    value: 'max-age=63072000; includeSubDomains; preload'
  },
  {
    key: 'X-Frame-Options',
    value: 'DENY'
  },
  {
    key: 'X-Content-Type-Options',
    value: 'nosniff'
  },
  {
    key: 'Referrer-Policy',
    value: 'origin-when-cross-origin'
  },
  {
    key: 'Content-Security-Policy',
    value: [
      "default-src 'self'",
      "script-src 'self' 'unsafe-eval' 'unsafe-inline'",
      "style-src 'self' 'unsafe-inline'",
      "img-src 'self' blob: data:",
      "font-src 'self'",
      "object-src 'none'",
      "base-uri 'self'",
      "form-action 'self'",
      "frame-ancestors 'none'",
      "upgrade-insecure-requests"
    ].join('; ')
  }
];

const nextConfig = {
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: securityHeaders,
      },
    ];
  },
};
```

### 7.2 Validación de Datos con Zod

#### Schema Validation Obligatorio
```typescript
// src/lib/validations/auth.ts
import { z } from 'zod';

export const loginSchema = z.object({
  email: z.string().email('Invalid email format'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
});

export const userSchema = z.object({
  id: z.string().uuid(),
  email: z.string().email(),
  name: z.string().min(1, 'Name is required'),
  role: z.enum(['admin', 'user', 'moderator']),
});

export type LoginInput = z.infer<typeof loginSchema>;
export type User = z.infer<typeof userSchema>;
```

#### Input Sanitization
```typescript
// src/lib/utils/sanitize.ts
import DOMPurify from 'isomorphic-dompurify';

export const sanitizeHtml = (dirty: string): string => {
  return DOMPurify.sanitize(dirty, {
    ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a'],
    ALLOWED_ATTR: ['href']
  });
};

export const sanitizeInput = (input: string): string => {
  return input.trim().replace(/[<>]/g, '');
};
```

### 7.3 Rate Limiting con Upstash Redis

#### Configuración de Rate Limiting
```typescript
// src/lib/rate-limit.ts
import { Ratelimit } from '@upstash/ratelimit';
import { Redis } from '@upstash/redis';

const redis = new Redis({
  url: process.env.UPSTASH_REDIS_REST_URL!,
  token: process.env.UPSTASH_REDIS_REST_TOKEN!,
});

export const ratelimit = new Ratelimit({
  redis,
  limiter: Ratelimit.slidingWindow(10, '10 s'), // 10 requests per 10 seconds
  analytics: true,
});

// API Route Example
export async function POST(request: Request) {
  const ip = request.headers.get('x-forwarded-for') ?? 'localhost';
  const { success } = await ratelimit.limit(ip);
  
  if (!success) {
    return new Response('Too Many Requests', { status: 429 });
  }
  
  // Continue with request processing
}
```

### 7.4 Variables de Entorno Seguras

#### Configuración Obligatoria
```bash
# .env.local
# Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Security
UPSTASH_REDIS_REST_URL=https://...
UPSTASH_REDIS_REST_TOKEN=...

# Monitoring
SENTRY_DSN=https://...
NEXT_PUBLIC_VERCEL_ANALYTICS_ID=...

# Application
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key-here
```

#### Validación de Variables
```typescript
// src/lib/env.ts
import { z } from 'zod';

const envSchema = z.object({
  NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: z.string().min(1),
  CLERK_SECRET_KEY: z.string().min(1),
  UPSTASH_REDIS_REST_URL: z.string().url(),
  UPSTASH_REDIS_REST_TOKEN: z.string().min(1),
  SENTRY_DSN: z.string().url().optional(),
});

export const env = envSchema.parse(process.env);
```

### 7.5 GDPR y Privacy Compliance

#### Cookie Consent Management
```typescript
// src/components/cookie-consent.tsx
'use client';

import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';

export function CookieConsent() {
  const [showConsent, setShowConsent] = useState(false);

  useEffect(() => {
    const consent = localStorage.getItem('cookie-consent');
    if (!consent) {
      setShowConsent(true);
    }
  }, []);

  const acceptCookies = () => {
    localStorage.setItem('cookie-consent', 'accepted');
    setShowConsent(false);
  };

  if (!showConsent) return null;

  return (
    <div className="fixed bottom-0 left-0 right-0 bg-background border-t p-4 z-50">
      <div className="container mx-auto flex items-center justify-between">
        <p className="text-sm text-muted-foreground">
          We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies.
        </p>
        <Button onClick={acceptCookies} size="sm">
          Accept
        </Button>
      </div>
    </div>
  );
}
```

#### Data Retention Policy
```typescript
// src/lib/data-retention.ts
export const DATA_RETENTION_POLICIES = {
  USER_SESSIONS: 30 * 24 * 60 * 60 * 1000, // 30 days
  AUDIT_LOGS: 365 * 24 * 60 * 60 * 1000,   // 1 year
  ANALYTICS: 90 * 24 * 60 * 60 * 1000,     // 90 days
} as const;

export async function cleanupExpiredData() {
  const now = Date.now();
  
  // Cleanup user sessions
  await redis.zremrangebyscore(
    'user-sessions',
    0,
    now - DATA_RETENTION_POLICIES.USER_SESSIONS
  );
  
  // Cleanup analytics data
  await redis.zremrangebyscore(
    'analytics',
    0,
    now - DATA_RETENTION_POLICIES.ANALYTICS
  );
}
```

## 8. Monitoreo y Analytics

### 8.1 Error Tracking con Sentry

#### Configuración Sentry
```typescript
// sentry.client.config.ts
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 1.0,
  debug: false,
  replaysOnErrorSampleRate: 1.0,
  replaysSessionSampleRate: 0.1,
  integrations: [
    new Sentry.Replay({
      maskAllText: true,
      blockAllMedia: true,
    }),
  ],
});
```

#### Error Boundary Personalizado
```typescript
// src/components/error-boundary.tsx
'use client';

import * as Sentry from '@sentry/nextjs';
import { ErrorBoundary as SentryErrorBoundary } from '@sentry/react';
import { Button } from '@/components/ui/button';

function ErrorFallback({ error, resetError }: { error: Error; resetError: () => void }) {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen p-4">
      <h2 className="text-2xl font-bold mb-4">Something went wrong</h2>
      <p className="text-muted-foreground mb-4">
        We've been notified about this error and will fix it soon.
      </p>
      <Button onClick={resetError}>Try again</Button>
    </div>
  );
}

export function ErrorBoundary({ children }: { children: React.ReactNode }) {
  return (
    <SentryErrorBoundary fallback={ErrorFallback} showDialog>
      {children}
    </SentryErrorBoundary>
  );
}
```

### 8.2 Logging Centralizado Avanzado

#### Sistema de Logger Estructurado
```typescript
// src/lib/logger.ts
import winston from 'winston';

const logger = winston.createLogger({
  level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'trae-ai' },
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
  ],
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple()
  }));
}

export const logInfo = (message: string, meta?: object) => {
  logger.info(message, meta);
};

export const logError = (message: string, error?: Error, meta?: object) => {
  logger.error(message, { error: error?.stack, ...meta });
};

export const logWarn = (message: string, meta?: object) => {
  logger.warn(message, meta);
};

export const logDebug = (message: string, meta?: object) => {
  logger.debug(message, meta);
};
```

### 8.3 Performance Monitoring

#### Core Web Vitals Tracking
```typescript
// src/lib/analytics.ts
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric: any) {
  // Send to your analytics service
  if (process.env.NODE_ENV === 'production') {
    fetch('/api/analytics', {
      method: 'POST',
      body: JSON.stringify(metric),
      headers: { 'Content-Type': 'application/json' },
    });
  }
}

export function initWebVitals() {
  getCLS(sendToAnalytics);
  getFID(sendToAnalytics);
  getFCP(sendToAnalytics);
  getLCP(sendToAnalytics);
  getTTFB(sendToAnalytics);
}
```

### 8.4 Vercel Analytics Integration

#### Configuración Vercel Analytics
```typescript
// src/app/layout.tsx
import { Analytics } from '@vercel/analytics/react';
import { SpeedInsights } from '@vercel/speed-insights/next';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        {children}
        <Analytics />
        <SpeedInsights />
      </body>
    </html>
  );
}
```

#### Custom Analytics Events
```typescript
// src/lib/analytics-events.ts
import { track } from '@vercel/analytics';

export const trackUserAction = (action: string, properties?: Record<string, any>) => {
  track(action, properties);
};

export const trackPageView = (page: string) => {
  track('page_view', { page });
};

export const trackError = (error: string, context?: Record<string, any>) => {
  track('error', { error, ...context });
};
```

### 8.5 Bundle Analysis

#### Configuración Bundle Analyzer
```typescript
// next.config.ts
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});

module.exports = withBundleAnalyzer({
  // ... other config
});
```

#### Scripts de Análisis
```json
// package.json
{
  "scripts": {
    "analyze": "ANALYZE=true npm run build",
    "analyze:server": "BUNDLE_ANALYZE=server npm run build",
    "analyze:browser": "BUNDLE_ANALYZE=browser npm run build"
  }
}
```

## 10. Estrategia de Testing Completa

### 10.1 Testing Pyramid

#### Configuración Jest y Testing Library
```typescript
// jest.config.js
const nextJest = require('next/jest');

const createJestConfig = nextJest({
  dir: './',
});

const customJestConfig = {
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testEnvironment: 'jest-environment-jsdom',
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/*.stories.{js,jsx,ts,tsx}',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
};

module.exports = createJestConfig(customJestConfig);
```

#### Setup Testing Environment
```typescript
// jest.setup.js
import '@testing-library/jest-dom';
import { server } from './src/mocks/server';

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

// Mock Next.js router
jest.mock('next/navigation', () => ({
  useRouter() {
    return {
      push: jest.fn(),
      replace: jest.fn(),
      prefetch: jest.fn(),
    };
  },
  useSearchParams() {
    return new URLSearchParams();
  },
  usePathname() {
    return '';
  },
}));
```

### 10.2 Unit Testing

#### Component Testing Example
```typescript
// src/components/__tests__/button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from '../ui/button';

describe('Button Component', () => {
  it('renders correctly', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByRole('button', { name: /click me/i })).toBeInTheDocument();
  });

  it('handles click events', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    
    fireEvent.click(screen.getByRole('button'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('applies correct variant styles', () => {
    render(<Button variant="destructive">Delete</Button>);
    const button = screen.getByRole('button');
    expect(button).toHaveClass('bg-destructive');
  });
});
```

#### Hook Testing
```typescript
// src/hooks/__tests__/use-local-storage.test.ts
import { renderHook, act } from '@testing-library/react';
import { useLocalStorage } from '../use-local-storage';

describe('useLocalStorage', () => {
  beforeEach(() => {
    localStorage.clear();
  });

  it('should return initial value', () => {
    const { result } = renderHook(() => useLocalStorage('test', 'initial'));
    expect(result.current[0]).toBe('initial');
  });

  it('should update localStorage when value changes', () => {
    const { result } = renderHook(() => useLocalStorage('test', 'initial'));
    
    act(() => {
      result.current[1]('updated');
    });

    expect(result.current[0]).toBe('updated');
    expect(localStorage.getItem('test')).toBe('"updated"');
  });
});
```

### 10.3 Integration Testing

#### API Route Testing
```typescript
// src/app/api/__tests__/users.test.ts
import { createMocks } from 'node-mocks-http';
import handler from '../users/route';

describe('/api/users', () => {
  it('should return users list', async () => {
    const { req, res } = createMocks({
      method: 'GET',
    });

    await handler(req, res);

    expect(res._getStatusCode()).toBe(200);
    const data = JSON.parse(res._getData());
    expect(data).toHaveProperty('users');
    expect(Array.isArray(data.users)).toBe(true);
  });

  it('should handle authentication', async () => {
    const { req, res } = createMocks({
      method: 'POST',
      headers: {
        authorization: 'Bearer invalid-token',
      },
    });

    await handler(req, res);
    expect(res._getStatusCode()).toBe(401);
  });
});
```

### 10.4 E2E Testing con Playwright

#### Configuración Playwright
```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

#### E2E Test Example
```typescript
// e2e/auth.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Authentication', () => {
  test('should login successfully', async ({ page }) => {
    await page.goto('/login');
    
    await page.fill('[data-testid="email"]', 'test@example.com');
    await page.fill('[data-testid="password"]', 'password123');
    await page.click('[data-testid="login-button"]');
    
    await expect(page).toHaveURL('/dashboard');
    await expect(page.locator('[data-testid="user-menu"]')).toBeVisible();
  });

  test('should show error for invalid credentials', async ({ page }) => {
    await page.goto('/login');
    
    await page.fill('[data-testid="email"]', 'invalid@example.com');
    await page.fill('[data-testid="password"]', 'wrongpassword');
    await page.click('[data-testid="login-button"]');
    
    await expect(page.locator('[data-testid="error-message"]')).toBeVisible();
    await expect(page.locator('[data-testid="error-message"]')).toContainText('Invalid credentials');
  });
});
```

### 10.5 Visual Regression Testing

#### Configuración Chromatic
```typescript
// .github/workflows/chromatic.yml
name: 'Chromatic'
on: push

jobs:
  chromatic-deployment:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm ci
      - run: npm run build-storybook
      - uses: chromaui/action@v1
        with:
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
```

#### Storybook Stories
```typescript
// src/components/ui/button.stories.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { Button } from './button';

const meta: Meta<typeof Button> = {
  title: 'UI/Button',
  component: Button,
  parameters: {
    layout: 'centered',
  },
  tags: ['autodocs'],
  argTypes: {
    variant: {
      control: { type: 'select' },
      options: ['default', 'destructive', 'outline', 'secondary', 'ghost', 'link'],
    },
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    children: 'Button',
  },
};

export const Destructive: Story = {
  args: {
    variant: 'destructive',
    children: 'Delete',
  },
};

export const AllVariants: Story = {
  render: () => (
    <div className="flex gap-2">
      <Button variant="default">Default</Button>
      <Button variant="destructive">Destructive</Button>
      <Button variant="outline">Outline</Button>
      <Button variant="secondary">Secondary</Button>
      <Button variant="ghost">Ghost</Button>
      <Button variant="link">Link</Button>
    </div>
  ),
};
```

### 10.6 Accessibility Testing

#### Configuración axe-core
```typescript
// jest-axe.setup.js
import { configureAxe } from 'jest-axe';

const axe = configureAxe({
  rules: {
    // Disable specific rules if needed
    'color-contrast': { enabled: true },
    'landmark-one-main': { enabled: true },
  },
});

export default axe;
```

#### Accessibility Tests
```typescript
// src/components/__tests__/accessibility.test.tsx
import { render } from '@testing-library/react';
import axe from '../../jest-axe.setup';
import { Button } from '../ui/button';

describe('Accessibility Tests', () => {
  it('should not have accessibility violations', async () => {
    const { container } = render(<Button>Accessible Button</Button>);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('should have proper ARIA attributes', () => {
    const { getByRole } = render(
      <Button aria-label="Close dialog" variant="ghost">
        ×
      </Button>
    );
    
    const button = getByRole('button');
    expect(button).toHaveAttribute('aria-label', 'Close dialog');
  });
});
```

## 11. DevOps y CI/CD

### 11.1 GitHub Actions Workflow

#### Configuración Principal CI/CD
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

env:
  NODE_VERSION: '18'
  PNPM_VERSION: '8'

jobs:
  quality-gates:
    name: Quality Gates
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Get pnpm store directory
        shell: bash
        run: |
          echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV

      - name: Setup pnpm cache
        uses: actions/cache@v3
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Spell Check
        run: pnpm run check:spell

      - name: Lint
        run: pnpm run lint

      - name: Type Check
        run: pnpm run type-check

      - name: Format Check
        run: pnpm run check:format

      - name: Unit Tests
        run: pnpm run test:coverage

      - name: Build
        run: pnpm run build

      - name: E2E Tests
        run: pnpm run test:e2e

      - name: Upload Coverage
        uses: codecov/codecov-action@v3
        with:
          token: ${{ secrets.CODECOV_TOKEN }}

  security-scan:
    name: Security Scan
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          scan-ref: '.'
          format: 'sarif'
          output: 'trivy-results.sarif'

      - name: Upload Trivy scan results
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: 'trivy-results.sarif'

  deploy-preview:
    name: Deploy Preview
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    needs: [quality-gates]
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          scope: ${{ secrets.VERCEL_ORG_ID }}

  deploy-production:
    name: Deploy Production
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    needs: [quality-gates, security-scan]
    environment: production
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
          scope: ${{ secrets.VERCEL_ORG_ID }}

      - name: Lighthouse CI
        uses: treosh/lighthouse-ci-action@v10
        with:
          configPath: './lighthouserc.js'
          uploadArtifacts: true
          temporaryPublicStorage: true
```

### 11.2 Configuración de Husky y Git Hooks

#### Pre-commit Hooks
```json
// package.json
{
  "scripts": {
    "prepare": "husky install",
    "pre-commit": "lint-staged",
    "pre-push": "npm run type-check && npm run test"
  },
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,yml,yaml}": [
      "prettier --write"
    ]
  }
}
```

#### Husky Configuration
```bash
#!/usr/bin/env sh
# .husky/pre-commit
. "$(dirname -- "$0")/_/husky.sh"

npm run pre-commit
```

```bash
#!/usr/bin/env sh
# .husky/pre-push
. "$(dirname -- "$0")/_/husky.sh"

npm run pre-push
```

### 11.3 Lighthouse CI Configuration

#### Configuración Lighthouse
```javascript
// lighthouserc.js
module.exports = {
  ci: {
    collect: {
      url: ['http://localhost:3000'],
      startServerCommand: 'npm run start',
      numberOfRuns: 3,
    },
    assert: {
      assertions: {
        'categories:performance': ['warn', { minScore: 0.9 }],
        'categories:accessibility': ['error', { minScore: 0.9 }],
        'categories:best-practices': ['warn', { minScore: 0.9 }],
        'categories:seo': ['warn', { minScore: 0.9 }],
      },
    },
    upload: {
      target: 'temporary-public-storage',
    },
  },
};
```

### 11.4 Feature Flags con Vercel

#### Configuración Feature Flags
```typescript
// src/lib/feature-flags.ts
import { unstable_flag as flag } from '@vercel/flags/next';

export const showNewDashboard = flag({
  key: 'new-dashboard',
  decide: () => false, // Default value
});

export const enableBetaFeatures = flag({
  key: 'beta-features',
  decide: () => process.env.NODE_ENV === 'development',
});
```

#### Uso en Componentes
```typescript
// src/app/dashboard/page.tsx
import { showNewDashboard } from '@/lib/feature-flags';

export default async function DashboardPage() {
  const isNewDashboard = await showNewDashboard();

  return (
    <div>
      {isNewDashboard ? (
        <NewDashboard />
      ) : (
        <LegacyDashboard />
      )}
    </div>
  );
}
```

### 11.5 Environment Management

#### Configuración de Entornos
```bash
# .env.example
# Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=
CLERK_SECRET_KEY=

# Database
DATABASE_URL=

# Security
UPSTASH_REDIS_REST_URL=
UPSTASH_REDIS_REST_TOKEN=

# Monitoring
SENTRY_DSN=
NEXT_PUBLIC_VERCEL_ANALYTICS_ID=

# Feature Flags
VERCEL_FLAGS_SECRET=

# Application
NEXT_PUBLIC_APP_URL=
NEXTAUTH_SECRET=
```

#### Validación de Variables
```typescript
// src/lib/env-validation.ts
import { z } from 'zod';

const envSchema = z.object({
  NODE_ENV: z.enum(['development', 'test', 'production']),
  NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: z.string().min(1),
  CLERK_SECRET_KEY: z.string().min(1),
  DATABASE_URL: z.string().url(),
  UPSTASH_REDIS_REST_URL: z.string().url(),
  UPSTASH_REDIS_REST_TOKEN: z.string().min(1),
  SENTRY_DSN: z.string().url().optional(),
  NEXT_PUBLIC_VERCEL_ANALYTICS_ID: z.string().optional(),
  NEXT_PUBLIC_APP_URL: z.string().url(),
  NEXTAUTH_SECRET: z.string().min(32),
});

export const env = envSchema.parse(process.env);
```

## 12. Design System Avanzado

### 12.1 Design Tokens

#### Configuración de Tokens
```typescript
// src/design-system/tokens.ts
export const designTokens = {
  colors: {
    primary: {
      50: '#eff6ff',
      100: '#dbeafe',
      500: '#3b82f6',
      900: '#1e3a8a',
    },
    semantic: {
      success: '#10b981',
      warning: '#f59e0b',
      error: '#ef4444',
      info: '#3b82f6',
    },
  },
  spacing: {
    xs: '0.25rem',
    sm: '0.5rem',
    md: '1rem',
    lg: '1.5rem',
    xl: '2rem',
  },
  typography: {
    fontFamily: {
      sans: ['Inter', 'system-ui', 'sans-serif'],
      mono: ['JetBrains Mono', 'monospace'],
    },
    fontSize: {
      xs: ['0.75rem', { lineHeight: '1rem' }],
      sm: ['0.875rem', { lineHeight: '1.25rem' }],
      base: ['1rem', { lineHeight: '1.5rem' }],
      lg: ['1.125rem', { lineHeight: '1.75rem' }],
      xl: ['1.25rem', { lineHeight: '1.75rem' }],
    },
  },
  borderRadius: {
    none: '0',
    sm: '0.125rem',
    md: '0.375rem',
    lg: '0.5rem',
    full: '9999px',
  },
  shadows: {
    sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',
    md: '0 4px 6px -1px rgb(0 0 0 / 0.1)',
    lg: '0 10px 15px -3px rgb(0 0 0 / 0.1)',
  },
} as const;
```

#### Tailwind Integration
```javascript
// tailwind.config.js
const { designTokens } = require('./src/design-system/tokens');

module.exports = {
  theme: {
    extend: {
      colors: designTokens.colors,
      spacing: designTokens.spacing,
      fontFamily: designTokens.typography.fontFamily,
      fontSize: designTokens.typography.fontSize,
      borderRadius: designTokens.borderRadius,
      boxShadow: designTokens.shadows,
    },
  },
};
```

### 12.2 Storybook Configuration

#### Configuración Principal
```typescript
// .storybook/main.ts
import type { StorybookConfig } from '@storybook/nextjs';

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|ts|tsx|mdx)'],
  addons: [
    '@storybook/addon-essentials',
    '@storybook/addon-interactions',
    '@storybook/addon-a11y',
    '@storybook/addon-design-tokens',
  ],
  framework: {
    name: '@storybook/nextjs',
    options: {},
  },
  typescript: {
    check: false,
    reactDocgen: 'react-docgen-typescript',
    reactDocgenTypescriptOptions: {
      shouldExtractLiteralValuesFromEnum: true,
      propFilter: (prop) => (prop.parent ? !/node_modules/.test(prop.parent.fileName) : true),
    },
  },
};

export default config;
```

#### Preview Configuration
```typescript
// .storybook/preview.ts
import type { Preview } from '@storybook/react';
import '../src/app/globals.css';

const preview: Preview = {
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/,
      },
    },
    backgrounds: {
      default: 'light',
      values: [
        { name: 'light', value: '#ffffff' },
        { name: 'dark', value: '#0f172a' },
      ],
    },
  },
  globalTypes: {
    theme: {
      description: 'Global theme for components',
      defaultValue: 'light',
      toolbar: {
        title: 'Theme',
        icon: 'paintbrush',
        items: ['light', 'dark'],
        dynamicTitle: true,
      },
    },
  },
};

export default preview;
```

### 12.3 Component Documentation

#### Documentación Automática
```typescript
// src/components/ui/button.stories.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { Button } from './button';

const meta: Meta<typeof Button> = {
  title: 'Design System/Button',
  component: Button,
  parameters: {
    layout: 'centered',
    docs: {
      description: {
        component: 'A versatile button component with multiple variants and sizes.',
      },
    },
  },
  tags: ['autodocs'],
  argTypes: {
    variant: {
      control: { type: 'select' },
      options: ['default', 'destructive', 'outline', 'secondary', 'ghost', 'link'],
      description: 'The visual style variant of the button',
    },
    size: {
      control: { type: 'select' },
      options: ['default', 'sm', 'lg', 'icon'],
      description: 'The size of the button',
    },
    disabled: {
      control: { type: 'boolean' },
      description: 'Whether the button is disabled',
    },
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    children: 'Button',
  },
};

export const Variants: Story = {
  render: () => (
    <div className="flex flex-wrap gap-2">
      <Button variant="default">Default</Button>
      <Button variant="destructive">Destructive</Button>
      <Button variant="outline">Outline</Button>
      <Button variant="secondary">Secondary</Button>
      <Button variant="ghost">Ghost</Button>
      <Button variant="link">Link</Button>
    </div>
  ),
  parameters: {
    docs: {
      description: {
        story: 'All available button variants.',
      },
    },
  },
};

export const Sizes: Story = {
  render: () => (
    <div className="flex items-center gap-2">
      <Button size="sm">Small</Button>
      <Button size="default">Default</Button>
      <Button size="lg">Large</Button>
      <Button size="icon">🚀</Button>
    </div>
  ),
};
```

## 13. Configuración PWA

### 13.1 Service Worker

#### Configuración Next.js PWA
```javascript
// next.config.js
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  runtimeCaching: [
    {
      urlPattern: /^https?.*/,
      handler: 'NetworkFirst',
      options: {
        cacheName: 'offlineCache',
        expiration: {
          maxEntries: 200,
        },
      },
    },
  ],
});

module.exports = withPWA({
  // ... other config
});
```

#### Manifest Configuration
```json
// public/manifest.json
{
  "name": "Trae AI Template",
  "short_name": "Trae AI",
  "description": "Modern Next.js template with best practices",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#3b82f6",
  "icons": [
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

### 13.2 Offline Support

#### Offline Indicator
```typescript
// src/components/offline-indicator.tsx
'use client';

import { useState, useEffect } from 'react';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Wifi, WifiOff } from 'lucide-react';

export function OfflineIndicator() {
  const [isOnline, setIsOnline] = useState(true);

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  if (isOnline) return null;

  return (
    <Alert className="fixed bottom-4 right-4 w-auto">
      <WifiOff className="h-4 w-4" />
      <AlertDescription>
        You're currently offline. Some features may be limited.
      </AlertDescription>
    </Alert>
  );
}
```

### 13.3 Push Notifications

#### Notification Service
```typescript
// src/lib/notifications.ts
export class NotificationService {
  static async requestPermission(): Promise<NotificationPermission> {
    if (!('Notification' in window)) {
      throw new Error('This browser does not support notifications');
    }

    return await Notification.requestPermission();
  }

  static async showNotification(title: string, options?: NotificationOptions) {
    const permission = await this.requestPermission();
    
    if (permission === 'granted') {
      new Notification(title, {
        icon: '/icons/icon-192x192.png',
        badge: '/icons/badge-72x72.png',
        ...options,
      });
    }
  }

  static async subscribeToWebPush() {
    if ('serviceWorker' in navigator && 'PushManager' in window) {
      const registration = await navigator.serviceWorker.ready;
      
      const subscription = await registration.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY,
      });

      // Send subscription to your server
      await fetch('/api/push/subscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(subscription),
      });
    }
  }
}
```

## 14. SEO y Performance

### 14.1 Meta Tags Dinámicos

#### Configuración SEO
```typescript
// src/lib/seo.ts
import { Metadata } from 'next';

interface SEOProps {
  title?: string;
  description?: string;
  keywords?: string[];
  image?: string;
  url?: string;
  type?: 'website' | 'article';
}

export function generateSEO({
  title = 'Trae AI Template',
  description = 'Modern Next.js template with best practices',
  keywords = ['Next.js', 'React', 'TypeScript', 'Tailwind CSS'],
  image = '/og-image.png',
  url = process.env.NEXT_PUBLIC_APP_URL,
  type = 'website',
}: SEOProps): Metadata {
  const fullTitle = title === 'Trae AI Template' ? title : `${title} | Trae AI Template`;

  return {
    title: fullTitle,
    description,
    keywords: keywords.join(', '),
    authors: [{ name: 'Trae AI Team' }],
    creator: 'Trae AI',
    publisher: 'Trae AI',
    robots: {
      index: true,
      follow: true,
      googleBot: {
        index: true,
        follow: true,
        'max-video-preview': -1,
        'max-image-preview': 'large',
        'max-snippet': -1,
      },
    },
    openGraph: {
      type,
      locale: 'en_US',
      url,
      title: fullTitle,
      description,
      siteName: 'Trae AI Template',
      images: [
        {
          url: image,
          width: 1200,
          height: 630,
          alt: title,
        },
      ],
    },
    twitter: {
      card: 'summary_large_image',
      title: fullTitle,
      description,
      images: [image],
      creator: '@traeai',
    },
    alternates: {
      canonical: url,
      languages: {
        'en-US': `${url}/en`,
        'es-ES': `${url}/es`,
        'fr-FR': `${url}/fr`,
      },
    },
  };
}
```

#### Uso en Páginas
```typescript
// src/app/about/page.tsx
import { generateSEO } from '@/lib/seo';

export const metadata = generateSEO({
  title: 'About Us',
  description: 'Learn more about our mission and team',
  keywords: ['about', 'team', 'mission', 'company'],
  url: `${process.env.NEXT_PUBLIC_APP_URL}/about`,
});

export default function AboutPage() {
  return (
    <div>
      <h1>About Us</h1>
      {/* Page content */}
    </div>
  );
}
```

### 14.2 Structured Data

#### JSON-LD Schema
```typescript
// src/components/structured-data.tsx
import Script from 'next/script';

interface OrganizationSchemaProps {
  name: string;
  url: string;
  logo: string;
  description: string;
}

export function OrganizationSchema({ name, url, logo, description }: OrganizationSchemaProps) {
  const schema = {
    '@context': 'https://schema.org',
    '@type': 'Organization',
    name,
    url,
    logo,
    description,
    sameAs: [
      'https://twitter.com/traeai',
      'https://github.com/traeai',
      'https://linkedin.com/company/traeai',
    ],
  };

  return (
    <Script
      id="organization-schema"
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(schema) }}
    />
  );
}

interface ArticleSchemaProps {
  title: string;
  description: string;
  author: string;
  datePublished: string;
  dateModified: string;
  image: string;
  url: string;
}

export function ArticleSchema({
  title,
  description,
  author,
  datePublished,
  dateModified,
  image,
  url,
}: ArticleSchemaProps) {
  const schema = {
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: title,
    description,
    author: {
      '@type': 'Person',
      name: author,
    },
    datePublished,
    dateModified,
    image,
    url,
    publisher: {
      '@type': 'Organization',
      name: 'Trae AI',
      logo: {
        '@type': 'ImageObject',
        url: '/logo.png',
      },
    },
  };

  return (
    <Script
      id="article-schema"
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(schema) }}
    />
  );
}
```

### 14.3 Core Web Vitals Optimization

#### Image Optimization
```typescript
// src/components/optimized-image.tsx
import Image from 'next/image';
import { useState } from 'react';

interface OptimizedImageProps {
  src: string;
  alt: string;
  width: number;
  height: number;
  priority?: boolean;
  className?: string;
}

export function OptimizedImage({
  src,
  alt,
  width,
  height,
  priority = false,
  className,
}: OptimizedImageProps) {
  const [isLoading, setIsLoading] = useState(true);

  return (
    <div className={`relative overflow-hidden ${className}`}>
      <Image
        src={src}
        alt={alt}
        width={width}
        height={height}
        priority={priority}
        quality={85}
        placeholder="blur"
        blurDataURL="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWGRkqGx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyJckliyjqTzSlT54b6bk+h0R//2Q=="
        onLoad={() => setIsLoading(false)}
        className={`
          duration-700 ease-in-out
          ${isLoading ? 'scale-110 blur-2xl grayscale' : 'scale-100 blur-0 grayscale-0'}
        `}
      />
    </div>
  );
}
```

#### Font Optimization
```typescript
// src/app/layout.tsx
import { Inter, JetBrains_Mono } from 'next/font/google';

const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
});

const jetbrainsMono = JetBrains_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-jetbrains-mono',
});

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" className={`${inter.variable} ${jetbrainsMono.variable}`}>
      <body className="font-sans">
        {children}
      </body>
    </html>
  );
}
```

### 14.4 Performance Monitoring

#### Web Vitals Reporting
```typescript
// src/lib/web-vitals.ts
import { getCLS, getFID, getFCP, getLCP, getTTFB, Metric } from 'web-vitals';

function sendToAnalytics(metric: Metric) {
  // Send to your analytics service
  const body = JSON.stringify({
    name: metric.name,
    value: metric.value,
    id: metric.id,
    delta: metric.delta,
    rating: metric.rating,
    navigationType: metric.navigationType,
  });

  if (navigator.sendBeacon) {
    navigator.sendBeacon('/api/analytics/web-vitals', body);
  } else {
    fetch('/api/analytics/web-vitals', {
      body,
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      keepalive: true,
    });
  }
}

export function reportWebVitals() {
  getCLS(sendToAnalytics);
  getFID(sendToAnalytics);
  getFCP(sendToAnalytics);
  getLCP(sendToAnalytics);
  getTTFB(sendToAnalytics);
}
```

#### Performance API Route
```typescript
// src/app/api/analytics/web-vitals/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { logInfo } from '@/lib/logger';

export async function POST(request: NextRequest) {
  try {
    const metric = await request.json();
    
    // Log the metric
    logInfo('Web Vitals Metric', {
      name: metric.name,
      value: metric.value,
      rating: metric.rating,
      userAgent: request.headers.get('user-agent'),
      url: request.headers.get('referer'),
    });

    // Store in your analytics database
    // await storeMetric(metric);

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('Error processing web vitals:', error);
    return NextResponse.json({ error: 'Failed to process metric' }, { status: 500 });
  }
}
```

### 14.5 Sitemap y Robots.txt

#### Sitemap Dinámico
```typescript
// src/app/sitemap.ts
import { MetadataRoute } from 'next';

export default function sitemap(): MetadataRoute.Sitemap {
  const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'https://example.com';
  
  // Static pages
  const staticPages = [
    '',
    '/about',
    '/contact',
    '/privacy',
    '/terms',
  ].map((route) => ({
    url: `${baseUrl}${route}`,
    lastModified: new Date(),
    changeFrequency: 'monthly' as const,
    priority: route === '' ? 1 : 0.8,
  }));

  // Dynamic pages (e.g., blog posts)
  // const dynamicPages = await getBlogPosts().then((posts) =>
  //   posts.map((post) => ({
  //     url: `${baseUrl}/blog/${post.slug}`,
  //     lastModified: new Date(post.updatedAt),
  //     changeFrequency: 'weekly' as const,
  //     priority: 0.6,
  //   }))
  // );

  return [...staticPages];
}
```

#### Robots.txt
```typescript
// src/app/robots.ts
import { MetadataRoute } from 'next';

export default function robots(): MetadataRoute.Robots {
  const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'https://example.com';

  return {
    rules: {
      userAgent: '*',
      allow: '/',
      disallow: ['/api/', '/admin/', '/_next/'],
    },
    sitemap: `${baseUrl}/sitemap.xml`,
  };
}
```

### 14.6 Bundle Optimization

#### Next.js Configuration
```typescript
// next.config.ts
import { NextConfig } from 'next';

const nextConfig: NextConfig = {
  // Enable experimental features
  experimental: {
    optimizeCss: true,
    optimizePackageImports: ['lucide-react', '@radix-ui/react-icons'],
  },

  // Compiler optimizations
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },

  // Image optimization
  images: {
    formats: ['image/avif', 'image/webp'],
    minimumCacheTTL: 60 * 60 * 24 * 30, // 30 days
  },

  // Webpack optimizations
  webpack: (config, { dev, isServer }) => {
    if (!dev && !isServer) {
      // Tree shaking optimization
      config.optimization.usedExports = true;
      config.optimization.sideEffects = false;
    }

    return config;
  },

  // Headers for caching
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
    ];
  },
};

export default nextConfig;
```

## 15. Compliance y Accessibility

### 15.1 GDPR Compliance

#### Privacy Policy Component
```typescript
// src/components/privacy-policy.tsx
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';

export function PrivacyPolicy() {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <>
      <Button variant="link" onClick={() => setIsOpen(true)}>
        Privacy Policy
      </Button>
      
      <Dialog open={isOpen} onOpenChange={setIsOpen}>
        <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>Privacy Policy</DialogTitle>
          </DialogHeader>
          
          <div className="space-y-4 text-sm">
            <section>
              <h3 className="font-semibold">Data Collection</h3>
              <p>We collect information you provide directly to us, such as when you create an account...</p>
            </section>
            
            <section>
              <h3 className="font-semibold">Data Usage</h3>
              <p>We use the information we collect to provide, maintain, and improve our services...</p>
            </section>
            
            <section>
              <h3 className="font-semibold">Your Rights</h3>
              <p>Under GDPR, you have the right to access, update, or delete your personal information...</p>
            </section>
          </div>
        </DialogContent>
      </Dialog>
    </>
  );
}
```

#### Data Export Functionality
```typescript
// src/lib/data-export.ts
export async function exportUserData(userId: string) {
  // Collect all user data
  const userData = {
    profile: await getUserProfile(userId),
    preferences: await getUserPreferences(userId),
    activity: await getUserActivity(userId),
    exportDate: new Date().toISOString(),
  };

  // Create downloadable file
  const blob = new Blob([JSON.stringify(userData, null, 2)], {
    type: 'application/json',
  });

  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `user-data-${userId}-${Date.now()}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
```

### 15.2 Accessibility Testing

#### Automated Testing
```typescript
// src/components/__tests__/accessibility.test.tsx
import { render } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import { Button } from '../ui/button';

expect.extend(toHaveNoViolations);

describe('Accessibility Tests', () => {
  it('should not have accessibility violations', async () => {
    const { container } = render(<Button>Test Button</Button>);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('should have proper keyboard navigation', () => {
    const { getByRole } = render(<Button>Test Button</Button>);
    const button = getByRole('button');
    
    expect(button).toHaveAttribute('tabIndex', '0');
    expect(button).toBeVisible();
  });

  it('should have proper ARIA labels', () => {
    const { getByRole } = render(
      <Button aria-label="Close modal">×</Button>
    );
    
    const button = getByRole('button');
    expect(button).toHaveAttribute('aria-label', 'Close modal');
  });
});
```

#### Focus Management
```typescript
// src/hooks/use-focus-trap.ts
import { useEffect, useRef } from 'react';

export function useFocusTrap(isActive: boolean) {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!isActive || !containerRef.current) return;

    const container = containerRef.current;
    const focusableElements = container.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    );

    const firstElement = focusableElements[0] as HTMLElement;
    const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;

    const handleTabKey = (e: KeyboardEvent) => {
      if (e.key !== 'Tab') return;

      if (e.shiftKey) {
        if (document.activeElement === firstElement) {
          lastElement.focus();
          e.preventDefault();
        }
      } else {
        if (document.activeElement === lastElement) {
          firstElement.focus();
          e.preventDefault();
        }
      }
    };

    container.addEventListener('keydown', handleTabKey);
    firstElement?.focus();

    return () => {
      container.removeEventListener('keydown', handleTabKey);
    };
  }, [isActive]);

  return containerRef;
}
```

## 16. Checklist de Implementación Final

### Pre-desarrollo
- [ ] Configuración inicial del proyecto con pnpm
- [ ] Instalación de dependencias según stack tecnológico
- [ ] Configuración de herramientas de desarrollo (ESLint, Prettier, Husky)
- [ ] Setup de Shadcn/ui con `npx shadcn@latest init`
- [ ] Configuración de spell checking con cspell
- [ ] Setup de SonarLint en IDE para feedback en tiempo real

### Desarrollo
- [ ] Implementación de autenticación con Clerk.js
- [ ] Configuración de internacionalización con next-intl
- [ ] Setup de Zustand para estado global
- [ ] Integración de TanStack Query para gestión de datos
- [ ] Implementación de tema claro/oscuro
- [ ] Creación de componentes base con Shadcn/ui
- [ ] Implementación de sistema de logging centralizado
- [ ] Configuración de manejo de errores con ErrorAlertsList

### Calidad (Sistema de Verificación Obligatorio)
- [ ] **Verificación ortográfica**: `pnpm run check:spell` (0 errores/advertencias)
- [ ] **Compilación de build**: `pnpm run build` (código de salida 0)
- [ ] **Linting y formateo**: `pnpm run lint` && `pnpm run check:format` (0 errores/advertencias)
- [ ] **Verificación de tipos**: TypeScript strict mode sin errores
- [ ] **Tests unitarios**: Cobertura mínima del 85% para funciones críticas
- [ ] **Tests E2E con Playwright**: Cobertura mínima del 80% en flujos críticos
- [ ] **Documentación JSDoc**: Completa en todas las funciones públicas
- [ ] **Revisión de accesibilidad**: WCAG 2.1 AA compliance
- [ ] **Checklist de React Performance**: Todos los puntos verificados
- [ ] **Git hooks funcionando**: Pre-commit y pre-push ejecutándose correctamente

### Scripts de Verificación Automatizada
```bash
# Ejecutar secuencia completa de verificación de calidad
pnpm run check:spell     # Verificación ortográfica
pnpm run lint           # Verificación ESLint
pnpm run check:format   # Verificación Prettier
pnpm run build          # Verificación TypeScript y build
pnpm run test           # Tests unitarios
pnpm run test:app       # Tests E2E con Playwright

# Script integrado de verificación pre-deploy
pnpm run check:isReady  # Ejecuta todas las verificaciones anteriores
```

### Producción
- [ ] Optimización de bundle size con análisis
- [ ] Configuración de variables de entorno
- [ ] Setup de CI/CD pipeline con verificaciones de calidad
- [ ] Documentación VitePress generada
- [ ] Performance audit (Lighthouse > 90)
- [ ] Verificación final con tolerancia cero para errores/advertencias

### Verificación de Cumplimiento de Reglas
- [ ] **Inglés obligatorio**: Todo código, comentarios, documentación y commits en inglés
- [ ] **Tipado estricto**: Prohibición absoluta del tipo 'any'
- [ ] **Logging centralizado**: No uso de métodos console directos
- [ ] **Arquitectura basada en características**: Organización por feature, no por tipo
- [ ] **Componentes type-safe**: Todos los componentes con interfaces TypeScript
- [ ] **Memoización adecuada**: React.memo, useCallback, useMemo implementados correctamente
- [ ] **Gestión de estado**: Zustand para estado global, hooks personalizados para lógica
- [ ] **Manejo de errores**: ErrorAlertsList con botones accionables
- [ ] **Commits convencionales**: Formato commitlint aplicado

---

**Nota Importante**: Este documento es la referencia obligatoria para todas las implementaciones de Trae AI. Cualquier desviación de estos estándares debe ser justificada y documentada explícitamente.

**Versión**: 2.0  
**Última actualización**: Enero 2025  
**Mantenido por**: Trae AI Development Team
